<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asya Dream Studio</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>

<style>
body{
  margin:0;
  background:#0b0b12;
  color:white;
  font-family:'Press Start 2P';
  text-align:center;
}
.hidden{display:none}
button{
  padding:10px 14px;
  margin:6px;
  font-family:'Press Start 2P';
  background:transparent;
  color:#0ff;
  border:2px solid #0ff;
  border-radius:12px;
  cursor:pointer;
}
button:hover{background:#0ff;color:black}
canvas{
  border:2px solid #f0f;
  border-radius:14px;
}
#leaderboard{
  margin-top:10px;
  border:1px solid #0ff;
  border-radius:12px;
  padding:8px;
  max-width:360px;
  margin-inline:auto;
}
.msg{font-size:10px;margin:4px}
</style>
</head>

<body>

<h1>ASYA DREAM STUDIO</h1>

<div id="login">
  <input id="nickname" placeholder="Takma ad">
  <br><br>
  <button onclick="enterSite()">GİR</button>
</div>

<div id="menu" class="hidden">
  <h3 id="hello"></h3>
  <button onclick="openGames()">OYUNLAR</button>
</div>

<div id="games" class="hidden">
  <h3>OYUNLAR</h3>
  <button onclick="openGame('bounce')">Neon Bounce</button>
  <button onclick="openGame('reaction')">Reaction Rush</button>
  <button onclick="openGame('runner')">Neon Runner</button>
  <br>
  <button onclick="backMenu()">MENÜ</button>
</div>

<div id="game" class="hidden">
  <h3 id="gameTitle"></h3>
  <div id="hud"></div>
  <canvas id="c" width="300" height="420"></canvas>
  <br>
  <button onclick="restart()">YENİDEN</button>
  <button onclick="backMenu()">MENÜ</button>

  <div id="leaderboard">
    <b>LEADERBOARD</b>
    <div id="lb"></div>
  </div>
</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyABqkhpL1SMRzRJ9GQLjjZE2IryqpAvMPw",
  authDomain: "pixelroom-ae218.firebaseapp.com",
  databaseURL: "https://pixelroom-ae218-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "pixelroom-ae218",
  storageBucket: "pixelroom-ae218.firebasestorage.app",
  messagingSenderId: "720297722320",
  appId: "1:720297722320:web:c815edae99d1efa7ff39d5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= GENEL ================= */
const $=id=>document.getElementById(id);
let nick="", game="", score=0, loop=null;
const ctx = $("c").getContext("2d");

function hideAll(){
  ["login","menu","games","game"].forEach(i=>$(i).classList.add("hidden"));
}

/* ================= LOGIN ================= */
function enterSite(){
  nick=$("nickname").value.trim();
  if(!nick) return alert("Nick gir");
  $("hello").innerText="Merhaba "+nick;
  hideAll(); $("menu").classList.remove("hidden");
}
function backMenu(){
  stopGame();
  hideAll(); $("menu").classList.remove("hidden");
}
function openGames(){
  hideAll(); $("games").classList.remove("hidden");
}

/* ================= LEADERBOARD ================= */
function lbRef(g){ return db.ref("leaderboard/"+g); }

async function submitBestScore(g,s){
  const ref=lbRef(g).child(nick);
  const snap=await ref.get();
  if(!snap.exists() || s>snap.val()){
    ref.set(s);
  }
}

async function loadLB(g){
  $("lb").innerHTML="Yükleniyor...";
  lbRef(g).orderByValue().limitToLast(10).on("value",snap=>{
    let arr=[];
    snap.forEach(c=>arr.push([c.key,c.val()]));
    arr.reverse();
    $("lb").innerHTML="";
    arr.forEach((x,i)=>{
      $("lb").innerHTML+=`<div class="msg">${i+1}. ${x[0]} : ${x[1]}</div>`;
    });
  });
}

async function showBest(g){
  const snap=await lbRef(g).orderByValue().limitToLast(1).get();
  let best=0;
  snap.forEach(s=>best=s.val());
  $("hud").innerHTML=`BEST SCORE: <b>${best}</b>`;
}

/* ================= GAME CORE ================= */
async function openGame(g){
  game=g; score=0;
  hideAll(); $("game").classList.remove("hidden");
  $("gameTitle").innerText=g.toUpperCase();
  await showBest(g);
  loadLB(g);
  startGame();
}

function restart(){
  stopGame();
  openGame(game);
}
function stopGame(){
  if(loop) clearInterval(loop);
  loop=null;
}

/* ================= GAMES ================= */
function startGame(){
  if(game==="bounce") bounce();
  if(game==="reaction") reaction();
  if(game==="runner") runner();
}

/* Neon Bounce */
function bounce(){
  let y=200,dy=3;
  loop=setInterval(()=>{
    ctx.clearRect(0,0,300,420);
    ctx.fillStyle="#0ff";
    ctx.beginPath();ctx.arc(150,y,10,0,Math.PI*2);ctx.fill();
    y+=dy;
    if(y<10||y>410){
      dy*=-1;
      score++;
      submitBestScore("bounce",score);
    }
    $("hud").innerHTML+=`<br>SKOR: ${score}`;
  },16);
}

/* Reaction Rush */
function reaction(){
  let ready=false,t0=0;
  $("hud").innerHTML="BEKLE...";
  setTimeout(()=>{
    ready=true;
    ctx.clearRect(0,0,300,420);
    ctx.fillStyle="#f0f";
    ctx.fillRect(120,190,60,40);
    t0=Date.now();
  },1000+Math.random()*2000);

  $("c").onclick=()=>{
    if(!ready) return;
    const ms=Date.now()-t0;
    score+=Math.max(0,500-ms);
    submitBestScore("reaction",score);
    $("hud").innerHTML=`TEPKİ: ${ms}ms<br>SKOR: ${score}`;
    ready=false;
  };
}

/* Neon Runner */
function runner(){
  let x=0;
  loop=setInterval(()=>{
    ctx.clearRect(0,0,300,420);
    ctx.fillStyle="#0ff";
    ctx.fillRect(x,380,30,30);
    x+=4;
    if(x>300){
      x=0;
      score++;
      submitBestScore("runner",score);
    }
    $("hud").innerHTML+=`<br>SKOR: ${score}`;
  },30);
}
</script>

</body>
</html>

